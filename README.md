## 2025.7.30 update ##
修改内容：windows开机自启动配置第五步，将 `启动时` 更改为 `登录时`

## 前言 ##
众所周知，华理的宿舍并不具备剩余电费低自动报警的功能， 
从而导致很多时候只有宿舍断电了，才能意识到需要充电这件事，无疑令人烦恼。<br>
因此，在gemini的帮助下，我写了个node.js脚本，需要手动部署，但至少不用再担心宿舍欠费了。<br>
## 功能亮点 ##
1. 可选开机自启动，一次部署后无需繁琐操作
2. 借助node.js和puppeteer后台运行，不会占用前台空间
3. 剩余电费低于7度时使用邮箱系统进行提醒，可借助电子邮箱服务提供商消息推送功能进行低电费提醒<br>
---
## 下载 ##
点击绿色的code，点击Download zip，将master分支下的所有文件打包下载并<b>右键</b>解压，请不要左键直接打开！

## 前置操作：安装Node.js ##
Node.js是该软件后台运行的重要依赖，请根据如下步骤安装：
1. 下载安装包：打开浏览器，访问 Node.js 官方网站： https://nodejs.org/ ，
选择最新LTS版本（即Long term service，一般是默认选择项）版本，滚动到最下面（不要管那堆代码），选择.msi（windows）或.pkg（macOS）安装包下载安装。
2. 双击运行，一直点击next按钮即可，直至安装完成。
3. 打开命令提示符（cmd）或powershell，运行如下两个命令：<br>
<code>node -v</code> <br>
<code>npm -v</code>
<br>如果均有版本号出现，则代表Node.js安装完成。

## 前置操作：登记学号，不过没法给你加创新学分 ##
使用记事本打开.env.example文件，里面主要分为三个部分，我们一个一个来讲：
1. 学生信息：顾名思义，<code>studentID</code>是你的学号，<code>ssoPassword</code>是你的<b>统一认证登录</b>密码（如果你是老登，就是你在25年7月头上发邮件给信息办重置的那个密码）
2. 宿舍信息：用来确定宿舍定向查询的，但是华理的相关变量设置毫无规律，请经由“宿舍信息.xls”查询，并对应输入。
3. 邮件发送相关：这一部分会更加复杂，先设置的是你的发件邮箱address@example.com<br>
**`EMAIL_HOST`**，如果你用的是华理学生邮箱，也就是学号@mail.ecust.edu.cn，无需改动；如果你用的是其它邮箱（address@example.com），请将其改为smtp.example.com，比如address@163.com，就改成smtp.163.com<br>
**`EMAIL_PORT`和`EMAIL_SECURE`**，不用改动<br>
**`EMAIL_USER`**，就是你用来发送提醒邮件的电子邮箱地址：address@example.com<br>
**`EMAIL_PASS`**，这**不是**你平时用的登录密码，请自行搜索“example邮箱”SMTP设置方法获取<br><br>
**`EMAIL_TO`**，你用来接收提醒邮件的电子邮箱地址

当你完成了以上设置，请保存该文件，并删去.example后缀，或者直接另存为.env，保存在同个目录下（同个文件夹内）。


## 初次使用部署方法 ##
1. 记住解压后文件夹的路径，请尽量选择全英文路径（本readme将以<code> D:\electricity </code>，也就是D盘下的electricity文件夹为例讲解）
2. 打开命令提示符（cmd），运行如下指令：<br>
<code>cd D:\electricity </code> <br>
3. 运行如下指令：<br>
<code>npm install </code> <br>
这将自动安装所需依赖项，其中puppeteer所占空间较大，约200MB，请确保有<b>稳定神奇的网络连接</b>与足够可用空间。
4. 在安装完依赖项后，运行如下指令：
`node index.js`

### 如果运行一切正常没有报错，那恭喜你，完成了这个程序的极其复杂不便的部署流程<br>可喜可贺，可喜可贺！ ###
如果报错了，也不要惊慌，在最上面一排按钮中有个issue，请提交cmd的报错截图，我会尽快回复！<br>

---
当然，如果要每次开机都手动运行一次 `node index.js`未免有点麻烦，因此，
## 如果你想要获得开机自启动的效果，请继续往下看 ##

### windows电脑：我们将借助“任务计划程序”，以下操作仅供参考 ###
1. 按 `Win + R` 键打开“运行”对话框
2. 输入 `taskschd.msc` ，按回车
3. 在右侧的“操作”窗格中，点击 “创建任务...”
4. 常规选项卡：<br>
名称：起一个描述性的名字，例如DormElecMonitor
描述：可选
5. 触发器选项卡：<br>
点击最下面的新建，在“开始任务”的下拉菜单中，选择 “登录时”。我在程序中内置了循环运行，因此可以不更改其他设置<br>
double check“已启用”已被勾选，点击确定保存
6. 操作选项卡：<br>
   点击 “新建...”。<br>
**操作**：应为“启动程序”。<br>
**程序/脚本**：这里要填写 node.exe 的完整绝对路径。通常是 C:\Program Files\nodejs\node.exe。您可以在文件资源管理器中找到它，然后复制路径。<br>
**添加参数**：这里填写您的 index.js 文件的完整绝对路径。例如：D:\electricity\index.js。<br>
**起始于**：建议填写项目所在的文件夹路径。例如：D:\electricity。
7. 根据自身需求更改条件和设置选项卡中的选项。点击确定即可保存
### Mac电脑：我们将借助“自动化（Automator）”，以下操作仅供参考 ###
我写不动了，返校前一定，如果你急着想部署可以看眼苹果官方的automator使用教程

## 通过这些操作，你理论上已经成功完成了软件部署！ ##
## 如果你想要自定义一些参数（比如提醒电费阈值，或者自动检查时间），请继续往下看 ##

在index.js第126行，`ALERT_THRESHOLD`是电费提醒阈值变量，你可以将7改为你希望的任何数字
<br>在index.js第173行，`schedule`是软件运行的时间，请注意保留空格和星号

---
碎碎念 <br>
我草累死我了，怎么readme都写了这么多，总之希望能够帮到你，作为一个台式机用户，没有少被突如其来的断电折磨；作为一个工科专业的学生，对编程并不精通，本项目也借助了ai的力量，如果有大佬愿意出力进一步优化代码，也很欢迎您fork该项目，或经过issue反馈意见！提前感谢！

---
版本迭代：
2025.7.29 V1.0